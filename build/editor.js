(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,s=window.wp.plugins,r=window.wp.editor,n=window.wp.components,i=window.wp.element,o=window.wp.data,c=window.wp.richText,a=window.wp.apiFetch;var l=e.n(a);const d=window.wp.i18n;(0,c.registerFormatType)("sgr-poc/highlight",{title:(0,d.__)("Style Guide Issue","sgr-poc"),tagName:"mark",className:"sgr-highlight",edit:({isActive:e,value:t,onChange:s})=>null});const u=()=>{const[e,s]=(0,i.useState)(!1),[r,a]=(0,i.useState)(null),[u,g]=(0,i.useState)(null),p=(0,o.useSelect)(e=>e("core/editor").getCurrentPostId(),[]),h=(0,o.useSelect)(e=>e("core/block-editor").getBlocks(),[]),{updateBlockAttributes:m}=(0,o.useDispatch)("core/block-editor"),{createNotice:w}=(0,o.useDispatch)("core/notices");return(0,t.createElement)(n.PanelBody,null,(0,t.createElement)(n.Button,{variant:"primary",onClick:()=>{s(!0),a(null),g(null),h.forEach(e=>{const t=e.attributes.content;if(t){const s=(0,c.removeFormat)(t,"sgr-poc/highlight");m(e.clientId,{content:s})}}),l()({path:"/sgr-poc/v1/review",method:"POST",data:{postId:p}}).then(e=>{a(e),e.issues&&e.issues.length>0&&(e=>{let t=0;const s=h.map(e=>{const s=(n=e.attributes.content||"")&&(new DOMParser).parseFromString(n,"text/html").body.textContent||"",r={clientId:e.clientId,text:s,start:t,end:t+s.length};var n;return t+=s.length+1,r});e.forEach(e=>{const t=s.find(t=>e.start>=t.start&&e.start<t.end+1);if(t){const s=h.find(e=>e.clientId===t.clientId);if(s&&s.attributes.content){const r=e.start-t.start,n=e.end-t.start;let i=(0,c.applyFormat)(s.attributes.content,{type:"sgr-poc/highlight",attributes:{class:`sgr-highlight sgr-highlight--${e.severity}`,"data-message":`${e.ruleId}: ${e.message}`}},r,n);m(t.clientId,{content:i})}}})})(e.issues),s(!1)}).catch(e=>{g(e.message||(0,d.__)("An unknown error occurred.","sgr-poc")),s(!1)})},disabled:e,isBusy:e},(0,d.__)("Review against Style Guide","sgr-poc")),u&&(0,t.createElement)(n.Notice,{status:"error",isDismissible:!0,onRemove:()=>g(null)},u),r&&(0,t.createElement)("div",{className:"sgr-results"},(0,t.createElement)("div",{className:`sgr-verdict sgr-verdict--${r.verdict}`},(0,d.__)("Verdict:","sgr-poc")," ",r.verdict.replace("_"," ")),r.issues&&0===r.issues.length?(0,t.createElement)("p",null,(0,d.__)("No issues found. Great job!","sgr-poc")):(0,t.createElement)("p",null,r.issues.length," ",1===r.issues.length?(0,d.__)("issue found","sgr-poc"):(0,d.__)("issues found","sgr-poc"),". See highlights in the editor.")))};(0,s.registerPlugin)("sgr-poc",{render:()=>(0,t.createElement)(r.PluginSidebar,{name:"sgr-poc-sidebar",title:(0,d.__)("Style Guide Reviewer","sgr-poc"),icon:"text-page"},(0,t.createElement)(u,null))})})();